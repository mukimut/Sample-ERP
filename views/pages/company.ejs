<div class="content-wrapper">
  <section class="content-header">
    <h1>
      Company
      <small>Profile</small>
    </h1>
    <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li><a href="#">Master</a></li>
      <li class="active">Company</li>
    </ol>
  </section>
  <section class="invoice">
    <div class="row">
      <div class="col-xs-12">
        <h2 class="page-header">
          <i class="fa fa-globe"></i> Company Basic Information
          <small class="pull-right">Date: 2/10/2019</small>
        </h2>
      </div>
    </div>
    <div class="row">
      <div class="col-md-10 form-horizontal">
        <div class="box-body">
          <div class="form-group">
            <label for="inputEmail3" class="col-sm-2 control-label">Company Name</label>

            <div class="col-sm-10">
              <input type="text" class="form-control" id="name" placeholder="Company Name">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Short Name</label>

            <div class="col-sm-10">
              <input type="text" class="form-control" id="shortname" placeholder="Company Short Name">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Company Type</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="companytype" placeholder="Company Type">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Phone</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="phone" placeholder="Phone">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Email</label>
            <div class="col-sm-10">
              <input type="email" class="form-control" id="email" placeholder="Email">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Website</label>
            <div class="col-sm-10">
              <input type="url" class="form-control" id="website" placeholder="Website">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">TIN No</label>
            <div class="col-sm-10">
              <input type="email" class="form-control" id="tinno" placeholder="TIN No">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <h2 class="page-header">
          <i class="fa fa-globe"></i>Address
        </h2>
      </div>
    </div>
    <div class="row" id="addressArea">
      <div class="col-md-10 form-horizontal">
        <div class="box-body">
          <div class="form-group">
            <label for="inputEmail3" class="col-sm-2 control-label">Address Type</label>
            <div class="col-sm-10">
              <select id="designation" class="form-control">
                <option>Select Address Type</option>
                <option>Organisation Address </option>
                <option>Head Quarter Address </option>
                <option>Factory Address </option>
                <option>Delivery Address </option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">District</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="district" placeholder="District">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Police Station</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="policestation" placeholder="Police Station">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Post Office</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="postOffice" placeholder="Post Office">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Post Code</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="postcode" placeholder="Post Code">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">House/ Plot/ Flat</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="HPF" placeholder="House/ Plot/ Flat">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Village/ Area/ Road</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="VAR" placeholder="Village/ Area/ Road">
            </div>
          </div>
        </div>
      </div>
      <button onclick="addAddress()">Add Address</button>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <h2 class="page-header">
          <i class="fa fa-globe"></i> Contact Person
        </h2>
      </div>
    </div>
    <div class="row" id="contactPerson">
      <div class="col-md-10 form-horizontal">
        <div class="box-body">
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Display Name</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="displayName" placeholder="Display Name">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Department</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="department" placeholder="Department">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Designation</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="designation" placeholder="Designation">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Contact No</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="contactNo" placeholder="Contact No">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Email Address</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="emailAdd" placeholder="Email Address">
            </div>
          </div>
        </div>
      </div>
      <button onclick="addContact()">Add Contact Person</button>
    </div>
    <div class="row">
      <div class="col-md-10">
        <div class="box-footer pull-right" style="border-top: 0px">
          <button class="btn btn-info" onclick="submit()">Save</button>
          <button class="btn btn-default" onclick="submitEdit()">Edit</button>
        </div>
      </div>
      <ul id="companylist"></ul>
    </div>
  </section>
  <div class="clearfix"></div>
</div>

<script>
  const idList = ['name', 'shortname', 'phone', 'mobile', 'email', 'website', 'address', 'district', 'companytype', 'postcode', 'lca'];
  let allCompanies = [];
  let selectedId;
  let addressSize = 1;

  getCompanies();

  function getSubmitData() {
    const object = {};

    idList.forEach(element => {
      let currentValue = document.getElementById(element).value;
      if (!currentValue) currentValue = '';
      object[element] = currentValue;
    });

    return object;
  }

  function submit() {
    const data = getSubmitData();
    $.post('/Company', data, (res) => {
      if (res) getCompanies();
    });
  }

  function getCompanies() {
    $.get('api/companies', (res) => {
      allCompanies = res;
      displayList();
    });
  }

  function submitEdit() {
    if (!selectedId) return;

    const data = getSubmitData();
    data.id = selectedId;

    $.post('/Company', data, (res) => {
      if (res) getCompanies();
    });
  }

  function displayList() {
    let string = '';
    const length = allCompanies.length;

    for (let i = 0; i < length; i++) {
      const currentCompany = allCompanies[i]
      string += '<li> Name: ' + currentCompany.name + ' Shortname: ';
      string += currentCompany.shortname;
      string += '<button onclick="edit(' + i + ')">Edit</button></li>';
    }

    document.getElementById('companylist').innerHTML = string;
  }

  function addContact() {
    const string = `<div class="col-md-10 form-horizontal"><div class="box-body"><div class="form-group">
        <label class="col-sm-2 control-label">Display Name</label><div class="col-sm-10">
        <input type="text" class="form-control" id="displayName` + addressSize + `" placeholder="Display Name">
        </div></div><div class="form-group"><label class="col-sm-2 control-label">Department</label>
        <div class="col-sm-10">
        <input type="text" class="form-control" id="department` + addressSize + `" placeholder="Department">
        </div></div><div class="form-group"><label class="col-sm-2 control-label">Designation</label>
        <div class="col-sm-10">
        <input type="text" class="form-control" id="designation` + addressSize + `" placeholder="Designation">
        </div></div><div class="form-group"><label class="col-sm-2 control-label">Contact No</label>
        <div class="col-sm-10"><input type="text" class="form-control" id="contactNo` + addressSize + `" placeholder="Contact No">
        </div></div><div class="form-group"><label class="col-sm-2 control-label">Email Address</label>
        <div class="col-sm-10">
        <input type="text" class="form-control" id="emailAdd` + addressSize + `" placeholder="Email Address">
        </div></div></div></div>`;
        addressSize++;
        const dom = document.getElementById('contactPerson');
        dom.innerHTML = dom.innerHTML + string;
  }

  function addAddress() {
    const address = `<div class="col-md-10 form-horizontal"><div class="box-body"><div class="form-group">
      <label class="col-sm-2 control-label">Address Type</label><div class="col-sm-10">
      <select id="addressType` + addressSize + `"  class="form-control"><option>Select Address Type</option>
      <option>Organisation Address </option><option>Head Quarter Address </option>
      <option>Factory Address </option><option>Delivery Address</option></select></div></div>
      <div class="form-group"><label class="col-sm-2 control-label">District</label><div class="col-sm-10">
      <input type="text" class="form-control" id="district ` + addressSize + `" placeholder="District">
      </div></div><div class="form-group"><label class="col-sm-2 control-label">Police Station</label>
      <div class="col-sm-10">
      <input type="text" class="form-control" id="policestation` + addressSize + `" placeholder="Police Station">
      </div></div><div class="form-group"><label class="col-sm-2 control-label">Post Office</label>
      <div class="col-sm-10">
      <input type="text" class="form-control" id="postOffice` + addressSize + `" placeholder="Post Office">
      </div></div><div class="form-group"><label class="col-sm-2 control-label">Post Code</label>
      <div class="col-sm-10">
      <input type="number" class="form-control" id="postcode` + addressSize + `" placeholder="Post Code">
      </div></div><div class="form-group"><label class="col-sm-2 control-label">House/ Plot/ Flat</label>
      <div class="col-sm-10"><input type="text" class="form-control" id="HPF" placeholder="House/ Plot/ Flat">
      </div></div><div class="form-group"><label class="col-sm-2 control-label">Village/ Area/ Road</label>
      <div class="col-sm-10">
      <input type="text" class="form-control" id="VAR` + addressSize + `" placeholder="Village/ Area/ Road">
      </div></div></div></div>`;
      addressSize++;
      const dom = document.getElementById('addressArea');
      dom.innerHTML = dom.innerHTML + address; 
  }

  function edit(index) {
    selectedId = allCompanies[index].id;

    idList.forEach(element => {
      document.getElementById(element).value = allCompanies[index][element];
    });
  }
</script>