
<div class="content-wrapper">
  <section class="content-header">
    <h1>
      Company
      <small>Profile</small>
    </h1>
    <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li><a href="#">Master</a></li>
      <li class="active">Company</li>
    </ol>
  </section>
  <section class="invoice">
    <div class="row">
      <div class="col-xs-12">
        <h2 class="page-header">
          <i class="fa fa-globe"></i> Company
          <small class="pull-right">Date: 2/10/2019</small>
        </h2>
      </div>
    </div>
    <div class="row invoice-info">
      <div class="col-md-6">
        <div class="box box-info">
          <form class="form-horizontal">
            <div class="box-body">
              <div class="form-group">
                <label for="inputEmail3" class="col-sm-2 control-label">Company Name</label>

                <div class="col-sm-10">
                  <input type="text" class="form-control" id="name" placeholder="Company Name">
                </div>
              </div>
              <div class="form-group">
                <label for="inputPassword3" class="col-sm-2 control-label">Short Name</label>

                <div class="col-sm-10">
                  <input type="text" class="form-control" id="shortname" placeholder="Company Short Name">
                </div>
              </div>
              <div class="form-group">
                <label for="inputPassword3" class="col-sm-2 control-label">Company Type</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="companytype" placeholder="Sector of Industry">
                </div>
              </div>
              <div class="form-group">
                <label for="inputPassword3" class="col-sm-2 control-label">Phone</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="phone" placeholder="Phone">
                </div>
              </div>
              <div class="form-group">
                <label for="inputPassword3" class="col-sm-2 control-label">Mobile</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="mobile" placeholder="Mobile">
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="col-md-6 form-horizontal">
          <div class="box-body">
            <div class="form-group">
              <label for="inputPassword3" class="col-sm-2 control-label">Email</label>
              <div class="col-sm-10">
                <input type="email" class="form-control" id="email" placeholder="Email">
              </div>
            </div>
            <div class="form-group">
              <label for="inputPassword3" class="col-sm-2 control-label">Website</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="website" placeholder="Website">
              </div>
            </div>
            <div class="form-group">
              <label for="inputPassword3" class="col-sm-2 control-label">District</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="district" placeholder="District">
              </div>
            </div>
            <div class="form-group">
              <label for="inputPassword3" class="col-sm-2 control-label">Post Code</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="postcode" placeholder="Post Code" value="0">
              </div>
            </div>
            <div class="form-group">
              <label for="inputPassword3" class="col-sm-2 control-label">Address</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="address" placeholder="Address">
              </div>
            </div>
            <div class="form-group">
              <label for="inputPassword3" class="col-sm-2 control-label">LCA No</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="lca" placeholder="LCA No">
              </div>
            </div>
          </div>
      </div>
      
      <div class="col-md-12">
      <div class="box-footer pull-right" style="border-top: 0px">
        <button class="btn btn-info" onclick="submit()">Save</button>
        <button class="btn btn-info" onclick="submitEdit()">Edit</button>
      </div>
    </div>
    <ul id="companylist"></ul>
    </div>
  </section>
  <div class="clearfix"></div>
</div>

<script>
  const idList = ['name', 'shortname', 'phone', 'mobile', 'email', 'website', 'address', 'district', 'companytype', 'postcode', 'lca'];
  let allCompanies = [];
  let selectedId;

  getCompanies();

  function getSubmitData() {
    const object = {};

    idList.forEach(element => {
      let currentValue = document.getElementById(element).value;
      if(!currentValue) currentValue = '';
      object[element] = currentValue;
    });

    return object;
  }
  
  function submit() {
    const data = getSubmitData();
    $.post('/Company', data, (res) => {
      if(res) getCompanies();
    });
  }

  function getCompanies() {
    $.get('api/companies', (res) => {
      allCompanies = res;
      displayList();
    });
  }

  function submitEdit() {
    if(!selectedId) return;

    const data = getSubmitData();
    data.id = selectedId;

    $.post('/Company', data, (res) => {
      if(res) getCompanies();
    });
  } 

  function displayList() {
    let string = '';
    const length = allCompanies.length;

    for(let i=0; i < length; i++) {
      const currentCompany = allCompanies[i]
      string += '<li> Name: ' + currentCompany.name + ' Shortname: ';
      string += currentCompany.shortname;
      string += '<button onclick="edit('+i+')">Edit</button></li>';
    }

    document.getElementById('companylist').innerHTML = string;
  }

  function edit(index) {
    selectedId = allCompanies[index].id;

    idList.forEach(element => {
      document.getElementById(element).value = allCompanies[index][element];
    });
  }
</script>