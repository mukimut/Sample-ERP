<style>
	.card {
		/* Add shadows to create the "card" effect */
		box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
		transition: 0.3s;
	}

	.boxbdymt {
		margin-top: 25px;
	}

	.noMarginPadding {
		margin: 0;
		padding: 0;
	}
</style>
<div class="content-wrapper">
	<section class="content-header">
		<h1>Page Permsiion<small>Settings</small></h1>
		<ol class="breadcrumb">
			<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
			<li><a href="#">Common Settings</a></li>
			<li class="active">LOV</li>
		</ol>
	</section>
	<section class="invoice">
		<div class="row">
			<div class="nav-tabs-custom">
				<ul class="nav nav-tabs">
					<li class="active"><a href="#tab_1" data-toggle="tab">User Permission</a></li>
					<li><a href="#tab_2" data-toggle="tab">Group Permission</a></li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="tab_1">
						<div class="row">
							<div class="col-md-12 form-horizontal">
								<div class="box-body">
									<div class="row">
										<div class="card col-md-5 form-horizontal col-md-offset-4">
											<div class="box-body boxbdymt">
												<div class="form-group">
													<div class="col-sm-12">
														<div class="row">
															<div class="col-sm-12">
																<select class="form-control" id="users">
																	<option hidden disabled selected value> Select User
																	</option>
																</select>
															</div>
														</div>
													</div>
												</div>
												<div class="form-group" id="userPages" style="margin-left: 0px;">
													<!-- <input type="checkbox" id="check0">Users<br>
													<input type="checkbox" id="check1">List of Values<br>
													<input type="checkbox" id="check2">Daily Expanse<br>
													<input type="checkbox" id="check3">Daily Expanse Dashboard<br>
													<input type="checkbox" id="check4">Party Payment<br>
													<input type="checkbox" id="check5">Payment Receive<br> -->
												</div>
												<div class="form-group">
													<div class="col-sm-12">
														<hr style="margin: 0px; padding: 0px;">
													</div>
												</div>
												
												<div class="row" style="margin-bottom: 20px;">
													<div class="col-md-10">
														<div class="row">
															<div class="box-footer pull-left"
																style="border-top: 0px; margin-left: 4px;">
																<button class="btn btn-flat btn-success"
																	onclick="save()">Save</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
					<!-- /.tab-pane -->
					<div class="tab-pane" id="tab_2">
						<div class="row">
							<div class="col-md-12 form-horizontal">
								<div class="card col-md-5 form-horizontal col-md-offset-4">
									<div class="box-body boxbdymt">
										<div class="form-group">
											<div class="col-sm-12">
												<div class="row">
													<div class="col-sm-12">
														<input type="text" class="form-control" id="groupName"
															placeholder="Group Name">
													</div>
												</div>
											</div>
										</div>
										<div class="row" style="margin-bottom: 20px;">
											<div class="col-md-10">
												<div class="row">
													<div class="box-footer pull-left"
														style="border-top: 0px; margin-left: 4px;">
														<button class="btn btn-flat btn-success"
															onclick="addGroup()">Add</button>
													</div>
												</div>
											</div>
										</div>
										<div class="form-group">
											<div class="col-sm-12">
												<div class="row">
													<div class="col-sm-12">
														<select class="form-control" id="groupList" onchange="groupSelected()"></select>
													</div> 
												</div>
											</div>
										</div>
										
										<div class="form-group" id="groupPages" style="margin-left: 0px;">
											<!-- <input type="checkbox" id="check0"> Users<br>
											<input type="checkbox" id="check1"> List of Values<br>
											<input type="checkbox" id="check2"> Daily Expanse<br>
											<input type="checkbox" id="check3"> Daily Expanse Dashboard<br>
											<input type="checkbox" id="check4"> Party Payment<br>
											<input type="checkbox" id="check5"> Payment Receive<br> -->
										</div>
										
										<div class="form-group">
											<div class="col-sm-12">
												<table id="valueList" style="width: 100%;"></table>
											</div>
										</div>
										<div class="row" style="margin-bottom: 20px;">
											<div class="col-md-10">
												<div class="row">
													<div class="box-footer pull-left"
														style="border-top: 0px; margin-left: 4px;">
														<button class="btn btn-flat btn-success"
															onclick="save()">Save</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- /.tab-pane -->
				</div>
				<!-- /.tab-content -->
			</div>
		</div>
	</section>
	<div class="clearfix"></div>
</div>
<script src="/js/dropdown.js"></script>
<script>
	const pages = ['Users', 'List of Values', 'Daily Expanse', 'Daily Expanse Dashboard', 'Party Payment', 'Payment Receive',];
	let allUsers = [], groupList = [];

	generateList('groupPages', 'groupCheck');
	generateList('userPages', 'userCheck');
	getGroups();


	$.get('/getUser', (data) => {
		allUsers = data;
		const usernames = data.map(element => element.username);
		setSelectionList('users', usernames, 'Select Users');
	});

	function getGroups() {
		$.get('/api/group', (data) => {
			groupList = data;
			setSelectionList('groupList', data.map(element => element.id), 'Select Group');
		});
	}

	function groupSelected() {
		deSelect();
		const selectedGroup = groupList[getSelectedIndex('groupList') - 1];
		if(selectedGroup.pages) selectedGroup.pages.forEach(page => {
			const index = pages.indexOf(page);
			document.getElementById('groupCheck' + index).checked = true;
		});
	}

	function deSelect() {
		const length = pages.length;
		for(let i = 0; i < length; i++) {
			document.getElementById('groupCheck' + i).checked = false;
		}
	}

	function generateList(id, checkId) {
		let listArea = document.getElementById(id).innerHTML;
		const length = pages.length;
		
		for(let i=0; i < length; i++ ) {
			listArea += '<input type="checkbox" id="' + checkId + i + '"> ' + pages[i] + '<br>';
		}

		document.getElementById(id).innerHTML = listArea;
	}

	function addGroup() {
		deSelect();
		const groupName = document.getElementById('groupName').value;
		if(groupList.includes(groupName)) {
			alert('Group already exists');
			return;
		}

		$.post('/api/group', {group: groupName}, (res) => {
			if(res.status) getGroups();
		});
	}

	function save() {
		let checkList = [];
		const length = pages.length
		for (let i = 0; i < length; i++) {
			if (document.getElementById('groupCheck' + i).checked) checkList.push(pages[i]);
		}

		const groupName = document.getElementById('groupList').value;


		$.post('/api/group', {group: groupName, pages: checkList}, (res) => {
			if(res.status) getGroups();
		});
	}
</script>